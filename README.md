# PTTW
PTTW (Pony Town Tweaker) - многофункциональный и расширяемый мод для Pony Town, позволяющий упростить игру, кастомизировать интерфейс и автоматизировать рутинные действия. Функционал мода может быть расширен с помощью встроенной системы скриптов.

> Моды запрещены правилами Pony Town. Разработчик PTTW не несёт ответственности за блокировку аккаунта из-за использования PTTW.

## Содержание
- [Установка](#установка)
  - [Установка на ПК](#установка-на-пк)
  - [Установка на мобильное устройство](#установка-на-мобильное-устройство)
- [Описание функций](#описание-функций)
  - [Настройки](#настройки)
  - [Скрипты](#скрипты)
  - [Поиск в чате](#поиск-в-чате)
  - [Спам-бот](#спам-бот)
  - [Список объявлений](#список-объявлений)
  - [Переводчик](#переводчик)
  - [Сохранение и загрузка скинов](#сохранение-и-загрузка-скинов)
  - [Привязка клавиш](#привязка-клавиш)
  - [Прочие команды](#прочие-команды)
- [Создание скриптов](#создание-скриптов)
  - [Общие сведения](#общие-сведения)
  - [Документация](#документация)
  - [Скрипты на Python](#скрипты-на-python)
  - [Примеры скриптов](#примеры-скриптов)

## Установка
### Установка на ПК
1. Установите менеджер пользовательских скриптов (рекомендуется Tampermonkey: [Chrome](https://chrome.google.com/webstore/detail/tampermonkey/dhdgffkkebhmkfjojejmpbldmpobfkfo) [Firefox](https://addons.mozilla.org/ru/firefox/addon/tampermonkey/) [Opera](https://addons.opera.com/ru/extensions/details/tampermonkey-beta/))
2. Установите [скрипт](https://raw.githubusercontent.com/pttw-dev/pttw/main/pttw.user.js)
### Установка на мобильное устройство
Вы можете использовать мобильные браузеры с поддержкой расширений для установки PTTW, например [Lemur Browser](https://play.google.com/store/apps/details?id=com.lemurbrowser.exts).  

## Описание функций
### Настройки
Главное окно PTTW, где можно включить, отключить или настроить большинство его функций. Доступны из меню настроек игры (кнопка с шестерёнкой) или по команде `/options`.
### Скрипты
Скрипты позволяют расширять функционал PTTW. Открыть окно управления скриптами можно из меню настроек игры (кнопка с шестерёнкой) или командой `/scripts`.
> Установка скриптов из внешних источников может быть опасной для вашего аккаунта. Разработчик PTTW не несёт ответственности за ущерб, причинённый вредоносными скриптами.
### Поиск в чате
Предоставляет возможность фильтровать сообщения в чате, производя поиск текста в имени отправителя сообщения или в тексте сообщения. Допустимо использование регулярных выражений.
### Спам-бот
Предоставляет возможность автоматически отправлять сообщения в чат. В тексте сообщения доступны следующие макросы:
| Макрос | Описание        |
| ------ | --------------- |
| `$i`   | Номер сообщения |
| `$r`   | Случайное число |
### Список объявлений
Предоставляет возможность поиска пати по объявлениям на причале через специальный интерфейс. Вызывается командой `/adlist`.
> На данный момент эта функция находится в разработке.
### Переводчик
Позволяет переводить входящие и исходящие сообщения с помощью переводчика Google.

На данный момент перевод входящих сообщений доступен только на русский язык. Если настройка "Переводить сообщения" включена, рядом с сообщениями, содержащими текст на других языках, будет появляться кнопка "Перевести".

Перевод исходящих сообщений доступен на любой язык, язык исходного сообщения определяется автоматически.
| Команда           | Описание |
| ----------------- | -------- |
| `/tr <код языка>` | Переводит все последующие сообщения на язык, заданный [двухбуквенным кодом](https://ru.wikipedia.org/wiki/%D0%9A%D0%BE%D0%B4%D1%8B_%D1%8F%D0%B7%D1%8B%D0%BA%D0%BE%D0%B2) |
| `/tr 0`           | Отключает переводчик исходящих сообщений |
### Сохранение и загрузка скинов
На данный момент сохранение и загрузка скинов доступно только через корзину.

#### Сохранение скина
1. Очистите корзину
2. Поместите нужный скин в корзину
3. Перезагрузите игру
4. Введите команду `/recl save 0`
#### Загрузка скина
1. Очистите корзину
2. Введите команду `/recl load 0`
3. Выберите файл скина, игра будет перезагружена автоматически
4. Восстановите скин из корзины

### Привязка клавиш
Предоставляет возможность привязывать сочетания клавиш к каким-либо действиям.  
Варианты сочетаний клавиш: `ctrl+alt+<клавиша>`, `ctrl+<клавиша>`, `alt+<клавиша>`, `<клавиша>`

| Команда | Описание |
| ------- | -------- |
| `/bind <сочетание клавиш> action` | Привязка сочетания клавиш к выполнению действия с панели действий. После ввода команды пользователю будет предложено выбрать действие нажатием правой кнопки мыши по его иконке. |
| `/bind <сочетание клавиш> chat <текст>` | Привязка сочетания клавиш к отправке текста в чат. Текст может содержать команды. |
| `/bind <сочетание клавиш> key <клавиша>` | Привязка сочетания клавиш к симуляции нажатия другой клавиши. |
| `/bind <сочетание клавиш> js <код>` | Привязка сочетания клавиш к выполнению произвольного JavaScript-кода. Объект `pt` доступен. |
| `/bind <cочетание клавиш> delete` | Удаление привязки сочетания клавиш. |
| `/bind <cочетание клавиш> -` | Удаление привязки сочетания клавиш. |

### Прочие команды
| Команда | Описание |
| ------- | -------- |
| `/reconnect <на спавн>` | Перезаход в игру. Если параметр `на спавн` равен 1, после перезахода персонаж окажется на спавне |
| `/spawn` | Перемещает персонажа на спавн |
| `/bri <значение>` | Устанавливает яркость игры в виде дробного значения, где `1.0` - яркость по умолчанию |
| `/savechat` | Сохраняет лог чата в текстовый файл |
| `/dlprev` | Скачивает превью скина из открытого профиля игрока |
| `/charlimit <лимит>` | Изменяет лимит символов в поле ввода сообщения. Сообщение будет обрезано игрой, если оно больше допустимого значения (для обычных игроков - 72 символа) |
| `/swc` | Переключает тип чата: обычный -> пати, пати -> обычный, шёпот -> обычный |
## Создание скриптов
### Общие сведения
Скрипты создаются на JavaScript (рекомендуется) или Python. Они могут использовать специальный API скриптов, позволяющий взаимодействовать с игрой.

После написания кода с помощью специального [редактора скриптов](https://ryzhpolsos.ru/pttw/editor/) необходимо добавить к скрипту метаданные, после чего его можно будет загрузить в игру.
### Документация
Документация API находится на [отдельной странице](docs.md).
### Скрипты на Python
Скрипты на Python выполняются с помощью [Brython](https://brython.info/), API PTTW предоставляется модулем `pt`.

Минимальный скрипт с поддержкой асинхронности:
```python
from browser import aio
import pt

async def main():
  # Код скрипта
  pass

aio.run(main())
```
### Примеры скриптов
#### Отправка сообщения в чат
JavaScript
```js
pt.chat.sendMessage('Hello World!');
```
Python
```python
import pt
pt.chat.sendMessage('Hello World!')
```
#### Добавление команды для перемещения персонажа
JavaScript
```js
pt.chat.registerCommand('move', ()=>{
  pt.move('right', 50);
});
```
Python
```python
import pt

def move():
  pt.move('right', 50)

pt.chat.registerCommand('move', move)
```
